#summary How to create adventures in SilverTree RPG

= Introduction =

SilverTree RPG has a fairly powerful language for specifying adventures. This language is very similar to the language used in Battle for Wesnoth, and so retains the same name, WML.

An adventure consists of a map, which has other possible maps one can enter (for instance, towns or caves, dungeons, and so forth). It also consists of various characters (NPCs) and items on the map, and a specification of how these NPCs and items behave.

The main adventure is currently defined in data/scenario.cfg and the contents look like this:

{{{
[scenario]
map="path/to/map"
...some other optional attributes...
  [party]
  ...One of these for each NPC 'party' on the map (and a special one for the PC party)...
  [/party]
  [settlement]
  ..One of these for each 'settlement' -- probably a cave or town -- on the map
  [/settlement]
  [event]
  ...Each of these defines a possible 'event handler' that will take some kind of action based on an event...
  [/event]
[/scenario]
}}}

= Scenario Attributes =

In addition to the map attribute, which gives the file path of the map the scenario uses, scenarios have a few simple attributes, all of which are optional with reasonable defaults:

hour/minute/second: the time of day the scenario starts at
border_tile: the definition of the tile that will be used for tiles outside the map (height and terrain type, same format as map tiles are in)
ambient_light: the color of ambient light to use when rendering the scenario
sun_light: the color of sun light (directed light, depending on time of day) to use when rendering the scenario
party_light; the color of the light that should come from the PC's party when rendering the scenario
party_light_power: the intensity of the light that should come from the PC's party when rendering the scenario

== Lighting and formulas ==

The lighting settings are actually all formulas. The game supports writing formulas for certain WML attributes that will be calculated when the game is run. See SilverTreeFormula.

= Events =

The {{{[event]}}} tag is used to capture various events that occur in-game. Each event has a set of inputs passed to the event that all the formulas within the event can reference.

All events receive certain inputs:

 * world -- the game world the event takes place in.
 * var -- all game variables.

{{{[event]}}} has three possible attributes:

event: the type of the event being caught. The events currently supported are,

 * start: fired when a scenario starts (including when a game is loaded; use first_time_only if you only want it to be handled once)
 * begin_move: fired whenever a party moves. Takes the party as input.
 * tick: fired every minute. Takes the standard set of inputs.
 * encounter: fired whenever the PC party encounters an NPC party. Takes 'pc' and 'npc' as inputs. You can use an {{{[encounter]}}} tag inside an NPC party definition to define an event handler for this kind of event as a convenience.
 * finish_script: if there is a movement script running (a set of scripted movements created with the execute_script WML command) will be fired when the script finishes. Takes 'name', the name of the script as an input.

filter: a formula which runs on the event's input. The event handler will only be run if the filter evaluates to true.

first_time_only: if set, the event handler will only be run once.